<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Teams Attendance App</title>

  <!-- Teams SDK -->
  <script src="https://statics.teams.cdn.office.net/sdk/v1.13.0/js/MicrosoftTeams.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f3f6fa;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 350px;
      padding: 25px;
      background: #ffffff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-radius: 10px;
      text-align: center;
    }

    .hidden {
      display: none;
    }

    h2 {
      color: #252423;
      font-size: 20px;
      margin-bottom: 20px;
    }

    h2 span {
      color: #6264A7;
      font-weight: 600;
    }

    input {
      width: 90%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      width: 95%;
      padding: 12px;
      margin-top: 20px;
      background: #6264A7;
      color: #fff;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    button:hover {
      background: #464775;
      transform: translateY(-2px);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .status-box {
      background: #eef3ff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: left;
    }

    .status-box p {
      margin: 8px 0;
      color: #252423;
      font-size: 15px;
    }

    .status-box span {
      font-weight: 600;
      color: #6264A7;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Welcome, <span id="userName">Loading...</span></h2>

    <button id="actionButton">Start</button>

    <div class="status-box">
      <p>Status: <span id="statusText">Not started</span></p>
      <p>Last Action Time: <span id="timeText">--:--:--</span></p>
    </div>
  </div>

  <script>
    let loggedInUser = "unknown@user.com";
    let userName = "Guest User";
    let isStarted = false;

    const WEBHOOK_URL = "YOUR_WEBAPP_URL"; // Replace with your Apps Script URL

    // ---------------------- INIT TEAMS APP --------------------------
    microsoftTeams.initialize(() => {
      console.log("Teams SDK Initialized");

      microsoftTeams.getContext((context) => {
        console.log("Teams Context:", context);

        loggedInUser = context.userPrincipalName || "unknown@user.com";
        userName = context.userDisplayName || loggedInUser;

        document.getElementById("userName").textContent = userName;
      });
    });

    // ---------------------- BUTTON ACTION ---------------------------
    document.getElementById("actionButton").addEventListener("click", () => {
      isStarted = !isStarted;

      let status = isStarted ? "Started" : "Ended";
      let btnLabel = isStarted ? "End" : "Start";

      document.getElementById("actionButton").textContent = btnLabel;
      document.getElementById("statusText").textContent = status;

      const now = new Date();
      const readableTime = now.toLocaleString();

      document.getElementById("timeText").textContent = readableTime;

      // ---------------------- SEND DATA -----------------------------
      const data = {
        user: loggedInUser,
        userName: userName,
        status: status,
        timestamp: now.toISOString(),
        readableTime: readableTime
      };

      console.log("=== Sending Data ===", data);

      fetch(WEBHOOK_URL, {
        method: "POST",
        mode: "cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(r => r.text())
      .then(res => console.log("Response:", res))
      .catch(err => console.error("Error:", err));
    });
  </script>
</body>
</html>
