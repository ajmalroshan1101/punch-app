<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Attendance</title>

  <!-- Microsoft Teams SDK -->
  <script src="https://statics.teams.cdn.office.net/sdk/v1.13.0/js/MicrosoftTeams.min.js"></script>

  <style>
    body {
      font-family: Segoe UI, Arial, sans-serif;
      padding: 15px;
      background: #f5f5f5;
    }
    h2 {
      margin-top: 0;
    }
    button {
      padding: 8px 16px;
      margin-right: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    .present { color: green; font-weight: bold; }
    .workover { color: red; font-weight: bold; }
    .notpresent { color: #666; }
    .info {
      font-size: 13px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
<h2>Employee Attendance</h2>

<div class="info">
  Logged in as: <b id="userEmail">Detecting...</b>
</div>

<table>
  <thead>
    <tr>
      <th>Email</th>
      <th>Name</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<button id="startBtn">Start</button>
<button id="endBtn">End</button>

<script>
  /* ðŸ”§ CHANGE THESE */
  const WRITE_URL = "https://script.google.com/macros/s/AKfycbyDNYxZDFb6KkaFOTr1-rEU5C6JPS0yyIaOApmRfj7yZ94R7vTahLLhSzQCqm0f4fZPgg/exec";
  const READ_URL  = "PASTE_READ_WEBAPP_URL";

  let user = { email: "", name: "" };

  function loadTable() {
    fetch(READ_URL)
      .then(r => r.json())
      .then(data => {
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        data.forEach(r => {
          const tr = document.createElement("tr");

          if (r.email.toLowerCase() === user.email.toLowerCase()) {
            tr.style.background = "#fff7cc";
          }

          let cls = "";
          if (r.status === "Present") cls = "present";
          else if (r.status === "Work over") cls = "workover";
          else cls = "notpresent";

          tr.innerHTML = `
            <td>${r.email}</td>
            <td>${r.name}</td>
            <td class="${cls}">${r.status}</td>
          `;
          body.appendChild(tr);
        });
      });
  }

  function send(action) {
    fetch(WRITE_URL, {
      method: "POST",
      body: JSON.stringify({
        email: user.email,
        name: user.name,
        action: action
      })
    }).then(loadTable);
  }

  document.getElementById("startBtn").onclick = () => send("start");
  document.getElementById("endBtn").onclick   = () => send("end");

  /* âœ… Teams + Browser fallback */
  if (window.microsoftTeams) {
    microsoftTeams.initialize();
    microsoftTeams.getContext(ctx => {
      user.email = (ctx.userPrincipalName || "").toLowerCase();
      user.name  = ctx.userDisplayName || "Teams User";
      document.getElementById("userEmail").innerText = user.email;
      loadTable();
    });
  } else {
    // Browser testing
    user.email = "a.roshan@msquare.pro";
    user.name  = "Roshan";
    document.getElementById("userEmail").innerText = user.email + " (test)";
    loadTable();
  }
</script>
</body>
</html>
